name: Build-APK-Undangan

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout-Kode
        uses: actions/checkout@v3

      - name: Setup-Java-17
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Install-Build-Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y zipalign apksigner zip

      - name: Build-APK-Mentah
        run: |
          rm -f unsigned.apk aligned.apk final.apk
          # Mengemas folder menjadi APK, mengabaikan file yang tidak perlu
          zip -r unsigned.apk . -x ".git/*" ".github/*" "META-INF/*" "*.keystore"

      - name: Proses-ZipAlign
        run: |
          zipalign -f -v 4 unsigned.apk aligned.apk

      - name: Proses-Signing
        run: |
          rm -f debug.keystore
          # Generate keystore baru secara otomatis
          keytool -genkeypair -v -keystore debug.keystore -alias androiddebugkey -keyalg RSA -keysize 2048 -validity 10000 -dname "CN=Android Debug,O=Android,C=US" -storepass android -keypass android
          # Sign APK
          apksigner sign --ks debug.keystore --ks-pass pass:android --key-pass pass:android --out final.apk aligned.apk
          # Verifikasi
          apksigner verify final.apk

      - name: Upload-Artifact
        uses: actions/upload-artifact@v3
        with:
          name: APK-Undangan-Final
          path: final.apk