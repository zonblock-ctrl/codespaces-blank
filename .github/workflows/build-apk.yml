name: Rakit Konfirmasi Undangan

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Kode
        uses: actions/checkout@v3

      - name: Setup Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Install Build Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y zipalign apksigner zip

      - name: Build APK Mentah
        run: |
          rm -f unsigned.apk aligned.apk Konfirmasi_Undangan.apk
          # Bungkus semua file menjadi APK
          zip -r unsigned.apk . -x ".git/*" ".github/*" "*.keystore"

      - name: Perbaikan ZipAlign
        run: |
          zipalign -f -v 4 unsigned.apk aligned.apk

      - name: Signing APK (DIPERBAIKI)
        run: |
          # Hapus keystore lama jika ada untuk menghindari error
          rm -f debug.keystore
          # Buat kunci baru dengan instruksi non-interaktif
          keytool -genkeypair -v -keystore debug.keystore -alias androiddebugkey -keyalg RSA -keysize 2048 -validity 10000 -dname "CN=Android Debug,O=Android,C=US" -storepass android -keypass android
          # Proses Signing
          apksigner sign --ks debug.keystore --ks-pass pass:android --key-pass pass:android --out Konfirmasi_Undangan.apk aligned.apk
          # Verifikasi hasil signing
          apksigner verify Konfirmasi_Undangan.apk

      - name: Upload Hasil Akhir
        uses: actions/upload-artifact@v3
        with:
          name: APK-Konfirmasi-Undangan
          path: Konfirmasi_Undangan.apk