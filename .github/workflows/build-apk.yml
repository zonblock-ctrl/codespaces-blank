name: Rakit Konfirmasi Undangan

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Kode
        uses: actions/checkout@v3

      - name: Setup Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Install Build Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y zipalign apksigner zip

      - name: Build APK Mentah
        run: |
          # Bersihkan sisa build sebelumnya
          rm -f unsigned.apk aligned.apk Konfirmasi_Undangan.apk
          # Bungkus folder menjadi APK, abaikan file metadata lama
          zip -r unsigned.apk . -x ".git/*" ".github/*" "META-INF/*" "*.keystore"

      - name: Perbaikan ZipAlign (Fix Error)
        run: |
          zipalign -f -v 4 unsigned.apk aligned.apk

      - name: Signing APK (Tanda Tangan Digital)
        run: |
          # Buat kunci keamanan baru otomatis
          keytool -genkeypair -v -keystore debug.keystore -alias androiddebugkey -keyalg RSA -keysize 2048 -validity 10000 -dname "CN=Android Debug,O=Android,C=US" -storepass android -keypass android
          # Sign agar bisa diinstal di HP tanpa "masalah penguraian"
          apksigner sign --ks debug.keystore --ks-pass pass:android --key-pass pass:android --out Konfirmasi_Undangan.apk aligned.apk
          # Verifikasi hasil akhir
          apksigner verify Konfirmasi_Undangan.apk

      - name: Upload Hasil Akhir
        uses: actions/upload-artifact@v3
        with:
          name: APK-Konfirmasi-Undangan
          path: Konfirmasi_Undangan.apk